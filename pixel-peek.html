<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R6 Pixel Peek - Live Fire</title>
    <style>
        /* --- THEME SETUP --- */
        :root {
            --bg-color: #1e1e24;
            --wall-color: #0f0f12;
            --accent-color: #4cc9f0;
            --enemy-head: #e74c3c;
            --enemy-body: #c0392b;
        }

        body {
            background-color: var(--bg-color);
            color: #fff;
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            user-select: none;
        }

        /* --- THE GAME SCENE --- */
        #game-container {
            position: relative;
            width: 800px;
            height: 500px;
            background: radial-gradient(circle at center, #2b2b36 0%, #000 100%);
            border: 2px solid #333;
            border-radius: 8px;
            overflow: hidden;
            cursor: crosshair;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }

        /* The Cover (Right Side - 50% Width) */
        .wall {
            position: absolute;
            right: 0;
            top: 0;
            width: 400px; /* Explicit width */
            height: 100%;
            background: #111; /* Solid background to ensure hiding */
            border-left: 4px solid #000;
            z-index: 20; /* High Z-Index to cover enemy */
        }

        /* The Enemy Character */
        #enemy {
            position: absolute;
            right: 50px; /* Starts DEEP behind the wall (Wall is 400px wide) */
            bottom: 140px;
            width: 60px;
            height: 140px;
            z-index: 10; /* Lower Z-Index than wall */
            
            /* Animation Setup */
            transition: transform 0.15s cubic-bezier(0.1, 0.7, 1.0, 0.1); 
            will-change: transform; /* optimizing performance */
        }

        /* Enemy Body Parts */
        .head {
            width: 40px; height: 40px;
            background-color: var(--enemy-head);
            border-radius: 50%;
            margin: 0 auto;
            border: 2px solid #5a0b0b;
        }
        .body {
            width: 60px; height: 100px;
            background-color: var(--enemy-body);
            border-radius: 8px;
            margin-top: -5px;
        }
        .gun {
            width: 50px; height: 10px; background: #000;
            position: absolute; top: 50px; left: -10px;
        }

        /* --- ACTIVE CLASSES --- */
        
        /* The Swing: Moves -400px Left */
        /* Start (50px) + Move (400px) = Ends at 450px from right (Visible) */
        .swinging {
            transform: translateX(-400px) !important; 
        }

        /* Dead Animation */
        .enemy-dead {
            transform: translateX(-400px) rotate(-90deg) translateY(100px) !important;
            transition: transform 0.3s ease-in !important;
            filter: grayscale(100%);
        }

        /* Overlays */
        .overlay-msg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            font-size: 3rem; font-weight: 900; 
            z-index: 100; pointer-events: none;
            text-shadow: 0 0 20px #000;
            opacity: 0; transition: opacity 0.1s;
        }
        
        #death-screen { background: rgba(255, 0, 0, 0.3); color: #fff; }
        
        #ui-layer { position: absolute; top: 20px; left: 20px; font-size: 1.2rem; z-index: 50; }
        
        #start-msg {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem; font-weight: bold; color: var(--accent-color);
            z-index: 50; pointer-events: none;
            background: rgba(0,0,0,0.8);
            padding: 20px; border-radius: 10px;
        }
    </style>
</head>
<body onmousedown="handleUserClick()">

    <div id="game-container">
        <div id="ui-layer">
            <div>Reaction: <span id="time-disp" style="color:var(--accent-color)">0 ms</span></div>
            <div>Status: <span id="status-disp">IDLE</span></div>
        </div>

        <div id="start-msg">CLICK ANYWHERE TO START</div>
        <div id="death-screen" class="overlay-msg">YOU DIED</div>

        <div id="enemy">
            <div class="head"></div>
            <div class="body"><div class="gun"></div></div>
        </div>

        <div class="wall"></div>
    </div>

    <div style="margin-top: 20px; text-align: center; color: #888;">
        <p><strong>Instructions:</strong> 1. Click to Start. 2. Wait (don't predict!). 3. Click when he swings.</p>
        <a href="index.html" style="color: var(--accent-color); text-decoration: none;">‚Üê Back to Dashboard</a>
    </div>

    <script>
        // --- ELEMENTS ---
        const enemyEl = document.getElementById('enemy');
        const deathScreen = document.getElementById('death-screen');
        const startMsg = document.getElementById('start-msg');
        const timeDisp = document.getElementById('time-disp');
        const statusDisp = document.getElementById('status-disp');

        // --- STATE ---
        let gameState = "IDLE"; // IDLE, HOLDING, SWINGING, ENDED
        let swingStartTime = 0;
        let killTimer = null;
        let swingTimeout = null;
        
        // --- SETTINGS ---
        const ENEMY_KILL_TIME = 300; // ms to kill you

        function handleUserClick() {
            if (gameState === "IDLE" || gameState === "ENDED") {
                startRound();
                return;
            }

            if (gameState === "HOLDING") {
                // User clicked while waiting -> FAIL
                failRound("PREFIRE");
                return;
            }

            if (gameState === "SWINGING") {
                // User clicked while enemy is out -> SUCCESS
                const reaction = Date.now() - swingStartTime;
                winRound(reaction);
            }
        }

        function startRound() {
            // 1. Reset Internal State
            gameState = "HOLDING";
            clearTimeout(killTimer);
            clearTimeout(swingTimeout);

            // 2. Reset UI
            deathScreen.style.opacity = "0";
            startMsg.style.display = "none";
            statusDisp.innerText = "HOLDING ANGLE...";
            statusDisp.style.color = "#fff";
            timeDisp.innerText = "0 ms";

            // 3. Reset Enemy Position (The Trick)
            enemyEl.classList.remove("swinging", "enemy-dead");
            
            // SUPER IMPORTANT: Force a browser reflow. 
            // This makes sure the browser 'sees' the enemy back at the start position 
            // before we try to move him again.
            void enemyEl.offsetWidth; 

            // 4. Set Random Timer (2 to 5 seconds)
            const randomTime = Math.random() * 3000 + 2000;
            
            swingTimeout = setTimeout(() => {
                // Check if we are still holding (user didn't click/quit)
                if(gameState === "HOLDING") {
                    triggerSwing();
                }
            }, randomTime);
        }

        function triggerSwing() {
            gameState = "SWINGING";
            swingStartTime = Date.now();

            // 1. Apply class to move enemy
            enemyEl.classList.add("swinging");

            // 2. Start the timer that kills the player
            killTimer = setTimeout(() => {
                if(gameState === "SWINGING") {
                    failRound("TOO_SLOW");
                }
            }, ENEMY_KILL_TIME);
        }

        function winRound(ms) {
            gameState = "ENDED";
            clearTimeout(killTimer); // You survived!

            // Update UI
            statusDisp.innerText = "HEADSHOT!";
            statusDisp.style.color = "#2ecc71"; // Green
            timeDisp.innerText = ms + " ms";
            
            // Animation: Enemy Dies
            enemyEl.classList.add("enemy-dead");

            // Show Restart Msg
            setTimeout(() => {
                startMsg.innerText = "CLICK TO GO AGAIN";
                startMsg.style.display = "block";
            }, 500);
        }

        function failRound(reason) {
            gameState = "ENDED";
            clearTimeout(killTimer);

            if (reason === "TOO_SLOW") {
                statusDisp.innerText = "YOU DIED";
                statusDisp.style.color = "#e74c3c";
                deathScreen.style.opacity = "1";
            } else if (reason === "PREFIRE") {
                statusDisp.innerText = "PRE-FIRE (TOO EARLY)";
                statusDisp.style.color = "orange";
                // Show him so you know you failed
                enemyEl.classList.add("swinging");
            }

            setTimeout(() => {
                startMsg.innerText = "CLICK TO RETRY";
                startMsg.style.display = "block";
            }, 500);
        }
    </script>
</body>
</html>
